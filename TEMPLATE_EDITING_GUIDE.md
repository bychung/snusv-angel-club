# 템플릿 편집 기능 사용 가이드

## 개요

규약 템플릿(LPA, PLAN 등)을 웹 UI에서 직접 수정할 수 있는 기능입니다.

## 주요 기능

### 1. 템플릿 수정 UI

- **위치**: 펀드 상세 페이지의 "현재 활성 템플릿" 섹션
- **버튼**: 상세보기 옆의 "수정" 버튼 클릭

### 2. 편집 인터페이스

#### 좌측 패널: 트리 네비게이션

- 계층 구조로 모든 섹션 표시
- 클릭하여 섹션 선택
- 변경된 항목은 파란색 점으로 표시
- 펼침/접기 기능

#### 우측 패널: 편집 영역

- **좌우 2단 비교 뷰**
  - 왼쪽: 기존 내용
  - 오른쪽: 수정 내용
- 변경된 텍스트는 파란색으로 표시
- 클릭하여 텍스트 편집 가능

### 3. 변수 처리

템플릿에는 `${fundName}`, `${totalCap}` 등의 변수가 포함되어 있습니다.

**변수 표시 방식:**

- 보라색 배경의 뱃지로 표시
- 변수 내용 수정 불가 (삭제만 가능)
- 새로운 변수 입력: `${변수명}` 형태로 입력하면 자동 인식

**예시:**

```
기존 텍스트: 본 조합의 명칭은 ${fundName}입니다
→ "본 조합의 명칭은" + [fundName] + "입니다"
   (일반 텍스트)   (변수 뱃지)   (일반 텍스트)
```

### 4. 검색 기능

- 상단 검색바에 키워드 입력
- 예: "관리보수" 검색
- 검색된 항목만 트리에 표시
- 해당 항목 자동으로 펼쳐짐
- 검색어는 노란색으로 하이라이트

### 5. 버전 관리 (자동)

변경 내용에 따라 자동으로 버전 번호가 결정됩니다:

**Major 변경 (x.0.0)**

- Depth 1 (장) 추가/삭제/변경
- 예: 제4장 추가/삭제

**Minor 변경 (x.y.0)**

- Depth 2 (조) 추가/삭제/변경
- 예: 제4조 1항 추가/삭제

**Patch 변경 (x.y.z)**

- Depth 3 이상 (항, 호) 추가/삭제/변경
- 예: 제4조 1항 1호 수정

**예시:**

```
현재 버전: v1.2.3

변경 내용:
- 제4조 수정 (Minor)
- 제5조 1항 1호 추가 (Patch)

→ 새 버전: v1.3.0 (가장 높은 변경 타입 적용)
```

### 6. 저장

1. 변경 완료 후 "저장" 버튼 클릭
2. 새 버전으로 템플릿 생성 (기존 버전 유지)
3. 새 템플릿이 자동으로 활성화
4. 변경 요약이 description에 저장

### 7. 초기화

- "초기화" 버튼: 모든 변경사항 취소
- 확인 다이얼로그 표시

### 8. 미리보기

- "미리보기" 버튼: 현재 수정 중인 내용으로 PDF 생성
- 실제 펀드 데이터와 결합하여 최종 결과 확인

## 기술 스택

### 프론트엔드

- React 컴포넌트 기반 UI
- Shadcn/ui 디자인 시스템
- 실시간 변경 추적

### 백엔드

- Next.js API Routes
- Supabase 데이터베이스
- 버전 히스토리 자동 관리

### 주요 파일

```
lib/admin/
  ├─ template-versioning.ts      # 버전 분석 및 계산
  └─ template-text-utils.ts      # 텍스트/변수 파싱

components/admin/
  ├─ TemplateEditModal.tsx        # 메인 모달
  ├─ ActiveTemplateInfo.tsx       # 활성 템플릿 정보 (수정 버튼 포함)
  └─ TemplateEditor/
      ├─ TemplateTree.tsx         # 트리 네비게이션
      ├─ TemplateTextEditor.tsx   # 텍스트 편집기 (2단 비교)
      ├─ TemplateVariableBadge.tsx # 변수 뱃지
      ├─ TemplateSearchBar.tsx    # 검색 바
      └─ TemplatePreviewModal.tsx # 미리보기

app/api/admin/templates/
  └─ [templateId]/route.ts        # 템플릿 수정 API
```

## 사용 흐름

1. **펀드 관리 페이지 접속**

   - `/admin/funds/[fundId]/manage`

2. **템플릿 섹션에서 "수정" 버튼 클릭**

   - 현재 활성 템플릿 정보 표시

3. **편집 모달에서 수정**

   - 왼쪽 트리에서 항목 선택
   - 오른쪽에서 내용 수정
   - 변수는 보호됨 (삭제만 가능)

4. **검색 활용**

   - 특정 단어로 빠르게 찾기

5. **미리보기 확인**

   - 실제 PDF로 어떻게 보이는지 확인

6. **저장**
   - 새 버전으로 저장
   - 자동으로 활성화

## 주의사항

1. **변수 보호**

   - 변수 이름을 직접 수정하지 말 것
   - 잘못된 변수는 PDF 생성 시 오류 발생

2. **버전 관리**

   - 모든 변경은 새 버전으로 저장됨
   - 기존 버전은 히스토리에 유지

3. **권한**

   - 최고 관리자만 템플릿 수정 가능

4. **테이블 섹션**
   - `type: "table"`인 섹션은 현재 편집 불가
   - 조합원 목록 등 동적 데이터
